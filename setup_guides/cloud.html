<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Deploying Pangeo on the Cloud &#8212; Pangeo 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pangeo-style.css" type="text/css" />
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Collaborators" href="../collaborators.html" />
    <link rel="prev" title="Getting Started with Pangeo on HPC" href="hpc.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/small_e_reversed_24px.png"></span>
          Pangeo</a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://medium.com/pangeo">Blog</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Pangeo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#mission-statement">Mission Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#goals">Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#get-involved">Get Involved</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Guide for Scientists</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#learn-about-pangeo-software">Learn About Pangeo Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#explore-the-use-cases">Explore the Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#try-out-a-pangeo-deployment">Try Out a Pangeo Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#give-feedback">Give Feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#contribute-a-use-case">Contribute a Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#contribute-data">Contribute Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#become-an-open-source-contributor">Become an Open Source Contributor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../packages.html">Packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#pangeo-core-packages">Pangeo Core Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#pangeo-affiliated-packages">Pangeo Affiliated Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#guidelines-for-new-packages">Guidelines for New Packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/index.html">Geoscience Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/index.html#physical-oceanography">Physical Oceanography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/index.html#meteorology">Meteorology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/index.html#climate-modeling">Climate Modeling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Technical Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#where-we-began">Where we began</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#interoperability-in-pangeo">Interoperability in Pangeo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#software">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#compute-platforms">Compute Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#storage-formats">Storage Formats</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Deployment Setup Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-up-pangeo-on-hpc-systems">Setting up Pangeo on HPC Systems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#setting-up-pangeo-on-cloud-systems">Setting up Pangeo on Cloud Systems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployments.html">Deployments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../deployments.html#cloud-computing-deployments">Cloud Computing Deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployments.html#high-performance-computing-deployments">High Performance Computing Deployments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">Pangeo and Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data.html#data-on-hpc">Data on HPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data.html#data-in-the-cloud">Data in the Cloud</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../collaborators.html">Collaborators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../collaborators.html#funding-agencies">Funding Agencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collaborators.html#institutions">Institutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collaborators.html#people">People</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Deploying Pangeo on the Cloud</a><ul>
<li><a class="reference internal" href="#step-one-install-the-necessary-software">Step One: Install the Necessary Software</a><ul>
<li><a class="reference internal" href="#google-cloud-sdk">Google Cloud SDK</a></li>
<li><a class="reference internal" href="#kubernetes-kubectl">Kubernetes Kubectl</a></li>
<li><a class="reference internal" href="#helm-client">Helm Client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-two-create-a-cluster">Step Two: Create a Cluster</a></li>
<li><a class="reference internal" href="#step-three-configure-kubernetes">Step Three: Configure Kubernetes</a></li>
<li><a class="reference internal" href="#step-four-create-cluster-specific-configuration">Step Four: Create Cluster-Specific Configuration</a></li>
<li><a class="reference internal" href="#step-five-deploy-helm-chart">Step Five: Deploy Helm Chart</a></li>
<li><a class="reference internal" href="#upgrade-cluster">Upgrade Cluster</a></li>
<li><a class="reference internal" href="#pangeo-helm-chart-and-docker-images">Pangeo Helm Chart and Docker Images</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Deploying Pangeo on the Cloud</a><ul>
<li><a class="reference internal" href="#step-one-install-the-necessary-software">Step One: Install the Necessary Software</a><ul>
<li><a class="reference internal" href="#google-cloud-sdk">Google Cloud SDK</a></li>
<li><a class="reference internal" href="#kubernetes-kubectl">Kubernetes Kubectl</a></li>
<li><a class="reference internal" href="#helm-client">Helm Client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-two-create-a-cluster">Step Two: Create a Cluster</a></li>
<li><a class="reference internal" href="#step-three-configure-kubernetes">Step Three: Configure Kubernetes</a></li>
<li><a class="reference internal" href="#step-four-create-cluster-specific-configuration">Step Four: Create Cluster-Specific Configuration</a></li>
<li><a class="reference internal" href="#step-five-deploy-helm-chart">Step Five: Deploy Helm Chart</a></li>
<li><a class="reference internal" href="#upgrade-cluster">Upgrade Cluster</a></li>
<li><a class="reference internal" href="#pangeo-helm-chart-and-docker-images">Pangeo Helm Chart and Docker Images</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content ">
      
  <div class="section" id="deploying-pangeo-on-the-cloud">
<span id="cloud"></span><h1>Deploying Pangeo on the Cloud<a class="headerlink" href="#deploying-pangeo-on-the-cloud" title="Permalink to this headline">¶</a></h1>
<p>The commercial cloud is a powerful environment in which to deploy a pangeo environment.
However, cloud computing is unfamiliar to most geoscientists.
The point of this guide is to describe how to setup up your own pangeo cluster
on the cloud platform of your choice, assuming zero knowledge of how the cloud works.
We do assume you are comfortable using the unix command line and have access
to one on your personal computer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide, and the Pangeo cloud configuration in general, is based heavily
on the <a class="reference external" href="https://zero-to-jupyterhub-with-kubernetes.readthedocs.io/en/latest/">Zero to Jupyterhub</a> guide. We strongly recommend that your read
that guide closely if you want a more comprehensive understanding.</p>
</div>
<p>This guide currently covers only deployment on <a class="reference external" href="https://cloud.google.com/">Google Cloud Platform</a>.
We hope to soon expand it to include AWS and Azure.</p>
<div class="section" id="step-one-install-the-necessary-software">
<h2>Step One: Install the Necessary Software<a class="headerlink" href="#step-one-install-the-necessary-software" title="Permalink to this headline">¶</a></h2>
<div class="section" id="google-cloud-sdk">
<span id="id1"></span><h3>Google Cloud SDK<a class="headerlink" href="#google-cloud-sdk" title="Permalink to this headline">¶</a></h3>
<p>The Google Cloud SDK is the command-line interface for Google Cloud Platform
products and services. Download and installation instructions are at
<a class="reference external" href="https://cloud.google.com/sdk/downloads">https://cloud.google.com/sdk/downloads</a></p>
</div>
<div class="section" id="kubernetes-kubectl">
<h3>Kubernetes Kubectl<a class="headerlink" href="#kubernetes-kubectl" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://kubernetes.io/docs/home/">Kubernetes</a> is an open source system for managing containerized applications in
the cloud. The Kubernetes command-line tool, <code class="docutils literal"><span class="pre">kubectl</span></code>, allows you to deploy
and manage applications on Kubernetes. It is necessary to deploy a Pangeo
cluster.</p>
<p>If you have already installed the Google Cloud SDK, the easiest way to install
kubectl is to run the following command on the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ gcloud components install kubectl
</pre></div>
</div>
<p>More comprehensive documentation for installing Kubernetes can be found at
<a class="reference external" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p>
</div>
<div class="section" id="helm-client">
<h3>Helm Client<a class="headerlink" href="#helm-client" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.helm.sh/">Helm</a> is a package manager for Kubernetes. Helm helps you automatically download
and deploy the Pangeo default configuration for your cluster.</p>
<p>To install the helm command line client, follow the installation instructions at
<a class="reference external" href="https://docs.helm.sh/install/">https://docs.helm.sh/install/</a></p>
<p>To do this in one line from the command line, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | bash
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-two-create-a-cluster">
<h2>Step Two: Create a Cluster<a class="headerlink" href="#step-two-create-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>First, you must create an account on the cloud provider of your choice.
Here we are using <a class="reference external" href="https://cloud.google.com/">Google Cloud Platform</a>.</p>
<p>All Google Cloud services are provisioned within the context of a
<a class="reference external" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">project</a>.
If you haven’t done so already, you should create a project and switch to it
in the Google Cloud console.
From the <em>APIs and Services</em> section of the cloud console, you must then
enable the Kubernetes Engine API for the project.</p>
<p>To create the cluster from the command line, you must first be authenticated.
Run the following from the commmand line</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud config <span class="nb">set</span> container/new_scopes_behavior <span class="nb">true</span>
gcloud auth login
</pre></div>
</div>
<p>Now here is a bash script that will create a cluster:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -e

<span class="nv">PROJECTID</span><span class="o">=</span>&lt;YOUR GOOGLE CLOUD PROJECT ID&gt;
<span class="c1"># this is the zone used by pangeo.pydata.org</span>
<span class="nv">ZONE</span><span class="o">=</span><span class="s1">&#39;us-central1-b&#39;</span>

<span class="c1"># cluster size settings: modify as needed to fit your needs / budget</span>
<span class="nv">NUM_NODES</span><span class="o">=</span><span class="m">2</span>
<span class="nv">MIN_WORKER_NODES</span><span class="o">=</span><span class="m">0</span>
<span class="nv">MAX_WORKER_NODES</span><span class="o">=</span><span class="m">100</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s1">&#39;pangeo&#39;</span>

<span class="c1"># https://cloud.google.com/compute/pricing</span>
<span class="c1"># change the machine typer based on your computing needs</span>
<span class="nv">WORKER_MACHINE_TYPE</span><span class="o">=</span><span class="s1">&#39;n1-standard-4&#39;</span>

<span class="c1"># create cluster on GCP</span>
gcloud config <span class="nb">set</span> project <span class="nv">$PROJECTID</span>
gcloud container clusters create <span class="nv">$CLUSTER_NAME</span> --num-nodes<span class="o">=</span><span class="nv">$NUM_NODES</span> --zone<span class="o">=</span><span class="nv">$ZONE</span> <span class="se">\</span>
    --machine-type<span class="o">=</span>n1-standard-2 --no-enable-legacy-authorization
gcloud container node-pools create worker-pool --zone<span class="o">=</span><span class="nv">$ZONE</span> --cluster<span class="o">=</span><span class="nv">$CLUSTER_NAME</span> <span class="se">\</span>
    --machine-type<span class="o">=</span><span class="nv">$WORKER_MACHINE_TYPE</span> --preemptible --enable-autoscaling <span class="se">\</span>
    --num-nodes<span class="o">=</span><span class="nv">$MIN_WORKER_NODES</span> --max-nodes<span class="o">=</span><span class="nv">$MAX_WORKER_NODES</span> --min-nodes<span class="o">=</span><span class="nv">$MIN_WORKER_NODES</span>
gcloud container clusters get-credentials <span class="nv">$CLUSTER_NAME</span> --zone<span class="o">=</span><span class="nv">$ZONE</span> --project <span class="nv">$PROJECTID</span>
</pre></div>
</div>
</div>
<div class="section" id="step-three-configure-kubernetes">
<h2>Step Three: Configure Kubernetes<a class="headerlink" href="#step-three-configure-kubernetes" title="Permalink to this headline">¶</a></h2>
<p>This script sets up the Kubernetes
<a class="reference external" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Role Based Access Control</a>
necessary for a secure cluster deployment.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -e

<span class="nv">EMAIL</span><span class="o">=</span>&lt;THE EMAIL ADDRESS ASSOCIATED WITH YOUR GOOGLE CLOUD ACCOUNT&gt;

kubectl create clusterrolebinding cluster-admin-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span><span class="nv">$EMAIL</span>
kubectl create serviceaccount tiller --namespace<span class="o">=</span>kube-system
kubectl create clusterrolebinding tiller --clusterrole<span class="o">=</span>cluster-admin --serviceaccount<span class="o">=</span>kube-system:tiller
helm init --service-account tiller
kubectl --namespace<span class="o">=</span>kube-system patch deployment tiller-deploy --type<span class="o">=</span>json <span class="se">\</span>
      --patch<span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/command&quot;, &quot;value&quot;: [&quot;/tiller&quot;, &quot;--listen=localhost:44134&quot;]}]&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-four-create-cluster-specific-configuration">
<h2>Step Four: Create Cluster-Specific Configuration<a class="headerlink" href="#step-four-create-cluster-specific-configuration" title="Permalink to this headline">¶</a></h2>
<p>There are two configuration files needed to deploy the Pangeo helm chart.
The first, <code class="docutils literal"><span class="pre">jupyter_config.yaml</span></code>, specifies modifications to the configuration
that are unique to each deploymment.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># file: jupyter_config.yaml</span>

<span class="l l-Scalar l-Scalar-Plain">jupyterhub</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">singleuser</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">cmd</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;start-singleuser.sh&#39;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">extraEnv</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">EXTRA_PIP_PACKAGES</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
      <span class="l l-Scalar l-Scalar-Plain">GCSFUSE_BUCKET</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">pangeo-data</span>
    <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">extraVolumes</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fuse</span>
          <span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/fuse</span>
      <span class="l l-Scalar l-Scalar-Plain">extraVolumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fuse</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/fuse</span>
    <span class="l l-Scalar l-Scalar-Plain">cloudMetadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">limit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
      <span class="l l-Scalar l-Scalar-Plain">guarantee</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">limit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">14G</span>
      <span class="l l-Scalar l-Scalar-Plain">guarantee</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4G</span>

  <span class="l l-Scalar l-Scalar-Plain">hub</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">extraConfig</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">customPodHook</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">from kubernetes import client</span>
        <span class="no">def modify_pod_hook(spawner, pod):</span>
            <span class="no">pod.spec.containers[0].security_context = client.V1SecurityContext(</span>
                <span class="no">privileged=True,</span>
                <span class="no">capabilities=client.V1Capabilities(</span>
                    <span class="no">add=[&#39;SYS_ADMIN&#39;]</span>
                <span class="no">)</span>
            <span class="no">)</span>
            <span class="no">return pod</span>
        <span class="no">c.KubeSpawner.modify_pod_hook = modify_pod_hook</span>
        <span class="no">c.JupyterHub.logo_file = &#39;/usr/local/share/jupyter/hub/static/custom/images/logo.png&#39;</span>
        <span class="no">c.JupyterHub.template_paths = [&#39;/usr/local/share/jupyter/hub/custom_templates/&#39;,</span>
                                      <span class="no">&#39;/usr/local/share/jupyter/hub/templates/&#39;]</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyterhub/k8s-hub</span>
      <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v0.6</span>
    <span class="l l-Scalar l-Scalar-Plain">extraVolumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">custom-templates</span>
        <span class="l l-Scalar l-Scalar-Plain">gitRepo</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">repository</span><span class="p p-Indicator">:</span> <span class="s">&quot;https://github.com/pangeo-data/pangeo-custom-jupyterhub-templates.git&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">revision</span><span class="p p-Indicator">:</span> <span class="s">&quot;b09721bb1a1248dc115730d3c8a791600eae257e&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">extraVolumeMounts</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/share/jupyter/hub/custom_templates</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">custom-templates</span>
        <span class="l l-Scalar l-Scalar-Plain">subPath</span><span class="p p-Indicator">:</span> <span class="s">&quot;pangeo-custom-jupyterhub-templates/templates&quot;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/share/jupyter/hub/static/custom</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">custom-templates</span>
        <span class="l l-Scalar l-Scalar-Plain">subPath</span><span class="p p-Indicator">:</span> <span class="s">&quot;pangeo-custom-jupyterhub-templates/assets&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">cull</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1200</span>
    <span class="l l-Scalar l-Scalar-Plain">every</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>

  <span class="c1"># this section specifies the IP address for pangeo.pydata.org</span>
  <span class="c1"># remove or change for a custom cluster</span>
  <span class="l l-Scalar l-Scalar-Plain">proxy</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">loadBalancerIP</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">35.224.8.169</span>
</pre></div>
</div>
<p>The other file is <code class="docutils literal"><span class="pre">secret_config.yaml</span></code>, which specifies cluster specific
encryption tokens. The jupyerhub proxy secret token is just a random hash, which you
can generate as follows.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ openssl rand -hex <span class="m">32</span>
</pre></div>
</div>
<p>Pangeo.pydata.org uses
<a class="reference external" href="https://help.github.com/enterprise/2.13/admin/guides/user-management/using-github-oauth/">GitHub OAuth Callback</a>
to authenticate users. The <code class="docutils literal"><span class="pre">clientSecret</span></code> token needs to be obtained via
github.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># file: secret_config.yaml</span>

<span class="l l-Scalar l-Scalar-Plain">jupyterhub</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">proxy</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">secretToken</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;SECRET&gt;</span>

  <span class="c1"># comment this out if not using github authentication</span>
  <span class="l l-Scalar l-Scalar-Plain">auth</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">github</span>
    <span class="l l-Scalar l-Scalar-Plain">github</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">clientId</span><span class="p p-Indicator">:</span> <span class="s">&quot;2cb5e09d5733ff2e6ae3&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">clientSecret</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;SECRET&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">callbackUrl</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://pangeo.pydata.org/hub/oauth_callback&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mrocklin</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">jhamman</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rabernat</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yuvipanda</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">choldgraf</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">jacobtomlinson</span>
</pre></div>
</div>
</div>
<div class="section" id="step-five-deploy-helm-chart">
<h2>Step Five: Deploy Helm Chart<a class="headerlink" href="#step-five-deploy-helm-chart" title="Permalink to this headline">¶</a></h2>
<p>Check the <a class="reference external" href="https://pangeo-data.github.io/helm-chart/">Pangeo Helm Chart</a> for
the latest helm chart version. Here the version we are using is <code class="docutils literal"><span class="pre">0.1.1-a14d55b</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -e

<span class="nv">VERSION</span><span class="o">=</span><span class="m">0</span>.1.1-a14d55b

helm repo add pangeo https://pangeo-data.github.io/helm-chart/
helm repo update

helm install pangeo/pangeo --version<span class="o">=</span><span class="nv">$VERSION</span> <span class="se">\</span>
   --namespace<span class="o">=</span>pangeo --name<span class="o">=</span>jupyter  <span class="se">\</span>
   -f secret-config.yaml <span class="se">\</span>
   -f jupyter-config.yaml
</pre></div>
</div>
<p>If you have not specified a static IP address in your configuration, the
jupyterhub will come up at a random IP address. To get the address, run the
command</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>kubectl --namespace<span class="o">=</span>pangeo get svc proxy-public
</pre></div>
</div>
<p>Here’s what we see for pangeo.pydata.org when we run this commmand:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">NAME</span>           <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>      <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>    <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>        <span class="n">AGE</span>
<span class="n">proxy</span><span class="o">-</span><span class="n">public</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.23</span><span class="o">.</span><span class="mf">255.193</span>   <span class="mf">35.224</span><span class="o">.</span><span class="mf">8.169</span>   <span class="mi">80</span><span class="p">:</span><span class="mi">30442</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">18</span><span class="n">d</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">EXTERNAL-IP</span></code> value is the address of the hub.</p>
</div>
<div class="section" id="upgrade-cluster">
<h2>Upgrade Cluster<a class="headerlink" href="#upgrade-cluster" title="Permalink to this headline">¶</a></h2>
<p>If you want to change the configuration, or to upgrade the cluster to a new
version of the Helm Chart, run the following commmand</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ helm upgrade --force --recreate-pods jupyter pangeo/pangeo <span class="se">\</span>
   --version<span class="o">=</span><span class="nv">$VERSION</span> <span class="se">\</span>
   -f secret-config.yaml <span class="se">\</span>
   -f jupyter-config.yaml
</pre></div>
</div>
</div>
<div class="section" id="pangeo-helm-chart-and-docker-images">
<h2>Pangeo Helm Chart and Docker Images<a class="headerlink" href="#pangeo-helm-chart-and-docker-images" title="Permalink to this headline">¶</a></h2>
<p>Pangeo maintains its own <a class="reference external" href="https://docs.helm.sh/">Helm</a> Chart and <a class="reference external" href="https://docker.com/">Docker</a> images. These hold the
default configuration for a Pangeo cloud deployment. These items live in
the Pangeo helm-chart repository:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/pangeo-data/helm-chart">https://github.com/pangeo-data/helm-chart</a></li>
</ul>
</div>
</div>


      
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Pangeo Team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>